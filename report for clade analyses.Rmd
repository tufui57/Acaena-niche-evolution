---
title: "Linear regressions for niche analysis of Acaena clades"
author: "Miki Nomura"
date: "27 February 2018"
output:
  pdf_document: default
  word_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(knitr)

# Root directory for rmd files is the folders where the files are in. 
opts_knit$set(root.dir='../')
```

```{r Data preparation, include=FALSE}

library(dplyr)
library(ggplot2)

normalizePath('../')

genus_name <- "Acaena"

source(
  paste(".//", genus_name, " niche evolution//06_Clade_pairing.R", sep = "")
       )
source(".//Acaena niche evolution//plotAnalysis_clade_niche.R")

ageVolData <- read.csv("NicheVolume_age.csv")
overlapPdData <- read.csv("Nicheovrlap_PD.csv")

```

## Sister species pairs' Phylogenetic distances ~ niche overlap of occurrence records
Niche overlap ranges 0 - 1, so I delimited y axis but it got rid of confidense interval from this figure.
```{r Phylogenetic distance - nihce overlap}
### Node numbers of sister species pairs
sispairs <- c(1,20,3,5,16)
sisOverlapPd <- (overlapPdData$node1 %in% sispairs) %>% overlapPdData[., ]

myplot <- plotAnalysis(data = sisOverlapPd, 
                       yv = "nicheOverlap", xv = "phyloDistance", 
                       nodeNumbercol = "node1", showStats = TRUE,
                       ylabname = "Niche overlap of occurrence records", 
                       xlabname = "Phylogenetic distances between sister species pairs",
                       label.point = TRUE
) +
  ylim(0, 1)

plot(myplot)

rm(myplot)

```

## Sister species pair - their ancestor's sister node
## Phylogenetic distances ~ niche overlap of occurrence records

```{r Sister species pair and their aunt clade}

ancSisNode <- sapply(sispairs, function(i){
  
  ancestor <- acaena$edge[which(i == acaena$edge[, 2])]
  ancestorSisNode <- distance2[distance2[,"node"] == ancestor, "sisterNode"]
  return(ancestorSisNode)
  
}
)

ancsisOverlapPd <- rbind(
  ((overlapPdData$node1 %in% ancSisNode) %>% overlapPdData[., ]),
  ((overlapPdData$node2 %in% ancSisNode) %>% overlapPdData[., ])
)

dup <- duplicated(ancsisOverlapPd$nicheOverlap) %>% which
ancsisOverlapPd <- ancsisOverlapPd[-dup, ]

myplot <- plotAnalysis(data = ancsisOverlapPd,
                       yv = "nicheOverlap", xv = "phyloDistance", 
                       nodeNumbercol = "node1", showStats = T,
                       ylabname = "Niche overlap of occurrence records", 
                       xlabname = "Phylogenetic distances between sister species pairs",
                       label.point = TRUE
) +
  ylim(0, 1)

plot(myplot)

rm(myplot)

```


## Clade Phylogenetic distances ~ niche overlap of occurrence records
```{r}
### Eliminate outlier, SAC, of clade age

overlapPd <- overlapPdData[which(overlapPdData$node1 != 19), ]

myplot <- plotAnalysis(data = overlapPd,
                       yv = "nicheOverlap", xv = "phyloDistance", 
                       nodeNumbercol = "node1", showStats = T,
                       ylabname = "Niche overlap of occurrence records",
                       xlabname = "Phylogenetic distances between clades",
                       label.point = TRUE
) +
  ylim(0, 1)
plot(myplot)
rm(myplot)


### Leave outlier of clade age in data

myplot <- plotAnalysis(data = overlapPdData, 
                       yv = "nicheOverlap", xv = "phyloDistance",
                       nodeNumbercol = "node1", showStats = T,
                       ylabname = "Niche overlap of occurrence records", 
                       xlabname = "Phylogenetic distances between clades",
                       label.point = TRUE
) +
  ylim(0, 1)
plot(myplot)

rm(myplot)
```

## Clade ages ~ niche volume of occurrence records

```{r}

### Eliminate outlier
outlier <- which(max(ageVolData$speciesAge) == ageVolData$speciesAge)

myplot <- plotAnalysis(data = ageVolData[-outlier,],
                       yv = "nicheVolume", xv = "speciesAge", 
                       nodeNumber = "node1", showStats = T,
                       ylabname = "Niche volume of occurrence records",
                       xlabname = "Clade age",
                       label.point = TRUE
) +
  ylim(0, 1)
plot(myplot)

rm(myplot)


### Leave outlier
myplot <- plotAnalysis(data = ageVolData,
                       yv = "nicheVolume", xv = "speciesAge", 
                       nodeNumber = "node1", showStats = T,
                       ylabname = "Niche volume of occurrence records",
                       xlabname = "Clade age",
                       label.point = TRUE
) +
  ylim(0, 1)
plot(myplot)
rm(myplot)
```

